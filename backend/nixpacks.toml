[phases.setup]
# Node 20 (required by Firebase), Python 3.11, C++ libs for numpy, and shell utilities
nixPkgs = ["nodejs_20", "python311", "python311Packages.pip", "python311Packages.virtualenv", "stdenv.cc.cc.lib", "zlib", "bash", "coreutils"]

[phases.install]
cmds = ["npm install"]

[phases.build]
cmds = [
    "python3 -m venv /app/.venv",
    "/app/.venv/bin/pip install --no-cache-dir -r requirements.txt"
]

[start]
cmd = "npm start"

[variables]
LD_LIBRARY_PATH = "/nix/store/*-gcc-*/lib:/root/.nix-profile/lib"
VIRTUAL_ENV = "/app/.venv"
PATH = "/app/.venv/bin:/root/.nix-profile/bin:/nix/var/nix/profiles/default/bin"

